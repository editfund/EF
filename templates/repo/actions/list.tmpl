{{template "base/head" .}}
<div class="page-content repository actions">
	{{template "repo/header" .}}
	<div class="ui container">
		{{template "base/alert" .}}

		{{/* Refresh the list every interval (30s) unless the document isn't visible or a dropdown is open; refresh
		if visibility changes as well. */}}
		<div
			hx-get="?workflow={{$.CurWorkflow}}&actor={{$.CurActor}}&status={{$.CurStatus}}&list_inner=true"
			hx-swap="morph:innerHTML"
			hx-trigger="every 30s [document.visibilityState === 'visible' && noActiveDropdowns()], visibilitychange[document.visibilityState === 'visible'] from:document"
			hx-indicator="#reloading-indicator">
			{{template "repo/actions/list_inner" .}}
		</div>
	</div>
</div>

<script type="text/javascript">

// Intent: If the "Actor" or "Status" dropdowns are currently open and being navigated, or the workflow dispatch
// dropdown form is open, the htmx refresh would replace them with closed dropdowns.  Instead this prevents the list
// refresh from occurring while those dropdowns are open.
//
// Can't inline this into the `hx-trigger` above because using a left-brace ('[') breaks htmx's trigger parsing.
function noActiveDropdowns() {
	return document.querySelector('[aria-expanded=true]') === null &&
		!document.querySelector('#branch-dropdown-form').checkVisibility();
}
</script>

{{template "base/footer" .}}
